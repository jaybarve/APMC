<!DOCTYPE html>
<html lang="mr">
<head>
  <title>शेतकरी तपशील</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="margin:0; font-family:Arial; background:#f4f6f8;">

<div style="background:#2e7d32; color:white; padding:16px; text-align:center; font-size:22px;">
  शेतकरी तपशील
</div>

<div style="padding:15px;">
  <div style="background:white; padding:10px; border-radius:12px;
       box-shadow:0 4px 12px rgba(0,0,0,0.15); overflow-x:auto;">

    <table style="width:100%; border-collapse:collapse; min-width:900px;">
      <thead>
        <tr style="background:#f0f0f0;">
          <th>शेतकरी नाव</th>
          <th>वक्कल नं</th>
          <th>वजन</th>
          <th>पिशवी</th>
          <th>दर</th>
          <th>खरेदीदार नाव</th>
          <th>खरेदीदार दर</th>
        </tr>
      </thead>

      <tbody id="farmerTable"></tbody>
    </table>

    <p id="errorMsg" style="color:red; display:none; text-align:center;">
      माहिती सापडली नाही
    </p>

  </div>
</div>

<!-- DATABASE -->
<script src="data.js"></script>

<script>
const params = new URLSearchParams(window.location.search);
const traderId = Number(params.get("id"));

const table = document.getElementById("farmerTable");
const errorMsg = document.getElementById("errorMsg");

if (!window.kandaDatabase) {
  errorMsg.innerText = "data.js लोड होत नाही";
  errorMsg.style.display = "block";
} else {
  const trader = kandaDatabase.find(t => t.traderId === traderId);

  if (!trader) {
    errorMsg.style.display = "block";
  } else {
    trader.farmers.forEach(farmer => {
      const count = farmer.records.length;

      farmer.records.forEach((rec, index) => {
        let row = "<tr>";

        if (index === 0) {
          row += `
            <td rowspan="${count}" style="padding:10px; font-weight:bold;">
              ${farmer.farmerName}
            </td>
            <td rowspan="${count}" style="padding:10px; text-align:center;">
              ${farmer.vakkalNo}
            </td>
          `;
        }

        row += `
          <td style="padding:10px; text-align:center;">${rec.weight}</td>
          <td style="padding:10px; text-align:center;">${rec.pishavi}</td>
          <td style="padding:10px; text-align:center;">${rec.rate}</td>
          <td style="padding:10px;">${rec.buyerName}</td>
          <td style="padding:10px; text-align:center;">${rec.buyerRate}</td>
        </tr>
        `;

        table.innerHTML += row;
      });

      table.innerHTML += `
        <tr>
          <td colspan="7" style="border-bottom:3px solid #2e7d32;"></td>
        </tr>
      `;
    });
  }
}
</script>

</body>
</html>
